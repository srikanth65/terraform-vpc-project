name: Test Slack Notifications

on:
  workflow_dispatch:

jobs:
  test-slack:
    runs-on: ubuntu-latest
    steps:
    - name: Test Main Slack Notification
      run: |
        if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
          curl -X POST -H 'Content-type: application/json' \
            --data '{
              "text": "üß™ Test notification from Terraform Infrastructure Bot",
              "attachments": [{
                "color": "good",
                "fields": [
                  {"title": "Status", "value": "GitHub Actions is working!", "short": true},
                  {"title": "Repository", "value": "${{ github.repository }}", "short": true}
                ]
              }]
            }' \
            ${{ secrets.SLACK_WEBHOOK_URL }}
          echo "‚úÖ Main Slack notification sent"
        else
          echo "‚ùå SLACK_WEBHOOK_URL secret not found"
        fi

    - name: Test Security Slack Notification
      run: |
        if [ -n "${{ secrets.SLACK_SECURITY_WEBHOOK_URL }}" ]; then
          curl -X POST -H 'Content-type: application/json' \
            --data '{
              "text": "üß™ Test security notification from Terraform Infrastructure Bot",
              "attachments": [{
                "color": "warning",
                "fields": [
                  {"title": "Status", "value": "Security alerts working!", "short": true},
                  {"title": "Repository", "value": "${{ github.repository }}", "short": true}
                ]
              }]
            }' \
            ${{ secrets.SLACK_SECURITY_WEBHOOK_URL }}
          echo "‚úÖ Security Slack notification sent"
        else
          echo "‚ùå SLACK_SECURITY_WEBHOOK_URL secret not found"
        fi

    - name: Test Teams Notification
      if: secrets.TEAMS_WEBHOOK_URL != ''
      run: |
        curl -H "Content-Type: application/json" \
          -d '{"text":"üß™ Test notification from Terraform Infrastructure Bot - GitHub Actions is working!"}' \
          ${{ secrets.TEAMS_WEBHOOK_URL }}
        echo "‚úÖ Teams notification sent"
